<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: JdiHook::BaseDebugger</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">JdiHook::BaseDebugger</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/jdi_hook/base_debugger_rb.html">
                lib/jdi_hook/base_debugger.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This is a base wrapper class for setting up an event handler for event
requests in a debugee target VM.
</p>
<p>
Implementations should override the following callbacks: <a
href="BaseDebugger.html#M000015">create_event_requests</a>, <a
href="BaseDebugger.html#M000016">receive_event</a>, and <a
href="BaseDebugger.html#M000017">cleanup</a>
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000017">cleanup</a>&nbsp;&nbsp;
      <a href="#M000015">create_event_requests</a>&nbsp;&nbsp;
      <a href="#M000014">filter_classes</a>&nbsp;&nbsp;
      <a href="#M000013">go</a>&nbsp;&nbsp;
      <a href="#M000012">new</a>&nbsp;&nbsp;
      <a href="#M000016">receive_event</a>&nbsp;&nbsp;
      <a href="#M000018">redirect_target_output</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_EXCLUDES</td>
          <td>=</td>
          <td class="context-item-value">[       # Base java/sun stuff to exclude       &quot;java.*&quot;, &quot;javax.*&quot;, &quot;sun.*&quot;, &quot;com.sun.*&quot;,        # several exclusions for jruby/jirb targets       &quot;org.jruby.*&quot;, &quot;jline.*&quot;, &quot;ruby.*&quot;, &quot;org.jcodings.*&quot;, &quot;jruby.*&quot;,        &quot;org.joni.*&quot;</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">class_filters_exc</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">class_filters_inc</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">vm</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(vm, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
<span class="ruby-comment cmt"># File lib/jdi_hook/base_debugger.rb, line 24</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">vm</span>, <span class="ruby-identifier">opts</span>={})
      <span class="ruby-ivar">@vm</span> = <span class="ruby-identifier">vm</span>
      <span class="ruby-ivar">@class_filters_exc</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:class_filters_exc</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">DEFAULT_EXCLUDES</span>
      <span class="ruby-ivar">@class_filters_inc</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:class_filters_inc</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-ivar">@debug_mode</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:debug_mode</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
      <span class="ruby-ivar">@redirect_stdio</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:redirect_stdio</span>]
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">cleanup</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This is a callback to handle the end of the debugging session override it
to perform any <a href="BaseDebugger.html#M000017">cleanup</a> tasks or
wrap up.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
<span class="ruby-comment cmt"># File lib/jdi_hook/base_debugger.rb, line 82</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cleanup</span>()
      <span class="ruby-comment cmt"># stub</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">create_event_requests</span><span class="method-args">(mgr)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This is a callback to set up event requests. It is called with one argument
&#8216;mgr&#8217; which is the event request manager for the target VM.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
<span class="ruby-comment cmt"># File lib/jdi_hook/base_debugger.rb, line 69</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_event_requests</span>(<span class="ruby-identifier">mgr</span>)
      <span class="ruby-comment cmt"># stub</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">filter_classes</span><span class="method-args">(req)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method adds class exclusion and inclusion filters to an event request.
It should be called from overridden <a
href="BaseDebugger.html#M000015">create_event_requests</a> implementations
while setting up <a href="BaseDebugger.html#M000012">new</a> event requests
for the target VM.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
<span class="ruby-comment cmt"># File lib/jdi_hook/base_debugger.rb, line 57</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filter_classes</span>(<span class="ruby-identifier">req</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">exc</span>=<span class="ruby-ivar">@class_filters_exc</span>
        <span class="ruby-identifier">exc</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">req</span>.<span class="ruby-identifier">addClassExclusionFilter</span>(<span class="ruby-identifier">e</span>) }
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">inc</span>=<span class="ruby-ivar">@class_filters_inc</span>
        <span class="ruby-identifier">inc</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">req</span>.<span class="ruby-identifier">addClassFilter</span>(<span class="ruby-identifier">i</span>) }
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">go</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method begins the debugging session setting up the event handler and
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
<span class="ruby-comment cmt"># File lib/jdi_hook/base_debugger.rb, line 34</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">go</span>
      <span class="ruby-ivar">@vm</span>.<span class="ruby-identifier">setDebugTraceMode</span>(<span class="ruby-ivar">@debug_mode</span>)
      <span class="ruby-identifier">create_event_requests</span>(<span class="ruby-ivar">@vm</span>.<span class="ruby-identifier">eventRequestManager</span>() )
      <span class="ruby-ivar">@evt_thread</span> = <span class="ruby-constant">EventThread</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>)
      <span class="ruby-ivar">@evt_thread</span>.<span class="ruby-identifier">start</span>()
      <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@redirect_stdio</span>
        <span class="ruby-identifier">redirect_target_output</span>(<span class="ruby-identifier">$stdout</span>, <span class="ruby-identifier">$stderr</span>) 
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-ivar">@vm</span>.<span class="ruby-identifier">resume</span>()
        <span class="ruby-ivar">@evt_thread</span>.<span class="ruby-identifier">join</span>()
      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">InterruptedException</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
        <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;** Got InterruptedException: #{exc}&quot;</span>
      <span class="ruby-keyword kw">ensure</span>
        <span class="ruby-identifier">cleanup</span>()
        <span class="ruby-ivar">@evt_thread</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">receive_event</span><span class="method-args">(event)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This is a callback to dispatch incoming events override it to perform
whatever specific actions you want based on the event type
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
<span class="ruby-comment cmt"># File lib/jdi_hook/base_debugger.rb, line 76</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">receive_event</span>(<span class="ruby-identifier">event</span>)
      <span class="ruby-comment cmt"># stub</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">redirect_target_output</span><span class="method-args">(out=$stdout, err=$stderr)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method starts and joins threads to redirect stderr and stdout from the
target process. Capturing IO this way from the target is generally only
possible if the target is connected through a command line launch
connector.
</p>
<p>
This method should only be called from the &#8216;<a
href="BaseDebugger.html#M000013">go</a>&#8217; method after the primary
event thread has been started but before it has been joined.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
<span class="ruby-comment cmt"># File lib/jdi_hook/base_debugger.rb, line 94</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">redirect_target_output</span>(<span class="ruby-identifier">out</span>=<span class="ruby-identifier">$stdout</span>, <span class="ruby-identifier">err</span>=<span class="ruby-identifier">$stderr</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">process</span> = <span class="ruby-ivar">@vm</span>.<span class="ruby-identifier">process</span>()
        <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@evt_thread</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@evt_thread</span>.<span class="ruby-identifier">connected</span>
          <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;the event thread has not yet been started&quot;</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">out_thread</span> = <span class="ruby-constant">StreamRedirectThread</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;target stdout reader&quot;</span>,
                                               <span class="ruby-identifier">process</span>.<span class="ruby-identifier">getInputStream</span>(),
                                               <span class="ruby-value str">&quot;Process STDOUT&quot;</span>,
                                               <span class="ruby-identifier">out</span>)

        <span class="ruby-identifier">err_thread</span> = <span class="ruby-constant">StreamRedirectThread</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;target stderr reader&quot;</span>,
                                               <span class="ruby-identifier">process</span>.<span class="ruby-identifier">getErrorStream</span>(),
                                               <span class="ruby-value str">&quot;Process STDERR&quot;</span>,
                                               <span class="ruby-identifier">err</span>)

        <span class="ruby-identifier">out_thread</span>.<span class="ruby-identifier">start</span>()
        <span class="ruby-identifier">err_thread</span>.<span class="ruby-identifier">start</span>()
        <span class="ruby-identifier">out_thread</span>.<span class="ruby-identifier">join</span>()
        <span class="ruby-identifier">err_thread</span>.<span class="ruby-identifier">join</span>()
        <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">out_thread</span>, <span class="ruby-identifier">err_thread</span>]
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;WARNING: can't redirect output on this target'&quot;</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>